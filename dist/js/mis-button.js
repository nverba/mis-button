(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/* global MISbtn */

'use strict';

(function () {
	'use strict';

	var popup = '\n\t\t<div class="misFrame">\n\t\t\t<div class="draghandle">\n\t\t\t\t<div class="misIco misMin"></div>\n\t\t\t</div>\n\t\t</div>\n\t  <iframe class="MiS_PopUp" src=""></iframe>\n\t';

	var sprite = '<div class="misBtnFill"><div class="misIco misMax"></div></div>';
	var buttons = document.getElementsByClassName("makeitsocial-button");
	var isMobile = false; // navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i);

	// Create & append the container for opened, minimised popups.
	var minimised = document.createElement('div');
	minimised.className = "misMinimised";
	document.body.appendChild(minimised);

	// DragCanvas isolates the popups from any underlying iframes that can capture drop events, a drag event removes the { pointer-events: none } class property.
	var dragcanvas = document.createElement('div');
	dragcanvas.className = "dragCanvas";
	document.body.appendChild(dragcanvas);

	window.MISbtn = {
		register: function register() {

			var buttons = document.getElementsByClassName("makeitsocial-button");
			for (var i = 0; i < buttons.length; i++) {
				var button = buttons[i];
				if (button.getAttribute('MisBtnReg')) {
					return;
				}
				console.log('register listener', button);
				createButton(buttons[i]);
				button.setAttribute('MisBtnReg', true);
			}
		},
		url: 'https://popup.makeitsocial.com/'
	};

	function createButton(button) {

		var active = false;
		var pid = button.getAttribute('data-pid');
		var coords = [window.innerWidth / 2 - 200, 20];
		var offset = [0, 0];

		var container = document.createElement('div');

		container.innerHTML = popup;
		container.setAttribute('draggable', 'true');
		container.setAttribute('ondragstart', "event.dataTransfer.setData('text/plain', 'This text may be dragged')"); // firefox data workaround
		container.className = "misCover";

		var loader = container.getElementsByClassName('misSpinner')[0];
		var iframe = container.getElementsByClassName('MiS_PopUp')[0];
		var minimi = container.getElementsByClassName('misMin')[0];
		var cachedPos = undefined;
		var isMinimised = undefined;

		var maximise = document.createElement('button');
		maximise.className = "misBtn";
		maximise.innerHTML = sprite;
		minimised.appendChild(maximise);

		container.addEventListener("dragend", function (event) {
			dragcanvas.className = "dragCanvas";
			updatePos(coords);
		}, false);

		container.addEventListener("dragstart", function (event) {
			dragcanvas.className = "dragCanvas activeDrag";
			offset = [event.offsetX, event.offsetY];
		}, false);

		dragcanvas.addEventListener("dragover", function (event) {
			event.preventDefault();
			coords = [event.clientX - offset[0], event.clientY - offset[1]];
		}, false);

		dragcanvas.addEventListener("drop", function (event) {
			event.preventDefault();
		}, false);

		function updatePos(c) {
			container.style.left = c[0] + 'px';
			container.style.top = c[1] + 'px';
		}

		function launchPopup(e) {

			if (isMobile) {
				window.location.href = MISbtn.url + '#/setup?pid=' + pid;
				return;
			}

			// Open only one popup per button;
			if (active) {
				if (isMinimised) {
					maximisePopup();
				}
				return;
			}

			dragcanvas.appendChild(container);
			updatePos([window.innerWidth / 2 - 200, 20]);
			active = true;

			// iframe.onload = function(e) {
			// 	// Give 1s to let page render with product details
			// 	setTimeout(function() {
			// 		loader.style.display = "none";
			// 		iframe.style.display = "block";
			// 	}, 1000);
			// };

			function minimisePopup() {
				cachedPos = [container.offsetLeft, container.offsetTop];
				container.className = "misCover misMoveMin misAnim";
				maximise.className = "misBtn mimimised";
				updatePos([document.body.offsetWidth - 300, window.innerHeight - 100]);
				isMinimised = true;
			}

			function maximisePopup() {
				container.className = "misCover misAnim";
				maximise.className = "misBtn";
				updatePos(cachedPos);
				isMinimised = false;
				setTimeout(function () {
					container.className = "misCover";
				}, 500);
			}

			function receiveMessage(event) {
				// This check is essential to avoid xss, this feature populates the maximise button text
				if (event.origin !== "https://popup-sandbox.herokuapp.com" && event.origin !== "https://popup.makeitsocial.com") {
					return;
				}
				var data = JSON.parse(event.data);
				if (data.pid === pid) {
					maximise.appendChild(document.createTextNode(data.name));
				}
			}

			window.addEventListener("message", receiveMessage, false);
			maximise.addEventListener('click', maximisePopup);
			minimi.addEventListener('click', minimisePopup);
			// used for local testing
			// iframe.setAttribute('src', "http://127.0.0.1:8080/#/setup?pid=" + pid);  
			iframe.setAttribute('src', MISbtn.url + '#/setup?pid=' + pid);
		}

		button.addEventListener('click', launchPopup);
	}
})();

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvaG9tZS9udmVyYmEvY29kZS9wb2x5bWVyL3J1YmJlci1lbGVtZW50cy9udmVyYmEvbWlzLWJ1dHRvbi9zcmMvanMvbWlzLWJ1dHRvbi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7QUNFQSxDQUFDLFlBQVc7QUFBRSxhQUFZLENBQUM7O0FBRTFCLEtBQUksS0FBSywwTEFPUixDQUFBOztBQUVELEtBQUksTUFBTSxvRUFBb0UsQ0FBQztBQUMvRSxLQUFJLE9BQU8sR0FBRyxRQUFRLENBQUMsc0JBQXNCLENBQUMscUJBQXFCLENBQUMsQ0FBQztBQUNyRSxLQUFJLFFBQVEsR0FBRyxLQUFLLENBQUE7OztBQUdwQixLQUFJLFNBQVMsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQzlDLFVBQVMsQ0FBQyxTQUFTLEdBQUcsY0FBYyxDQUFDO0FBQ3JDLFNBQVEsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxDQUFDOzs7QUFHckMsS0FBSSxVQUFVLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUMvQyxXQUFVLENBQUMsU0FBUyxHQUFHLFlBQVksQ0FBQztBQUNwQyxTQUFRLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsQ0FBQzs7QUFFdEMsT0FBTSxDQUFDLE1BQU0sR0FBRztBQUNmLFVBQVEsRUFBRSxvQkFBVzs7QUFFcEIsT0FBSSxPQUFPLEdBQUcsUUFBUSxDQUFDLHNCQUFzQixDQUFDLHFCQUFxQixDQUFDLENBQUM7QUFDckUsUUFBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7QUFDeEMsUUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3hCLFFBQUksTUFBTSxD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LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLyogZ2xvYmFsIE1JU2J0biAqL1xuXG4oZnVuY3Rpb24oKSB7ICd1c2Ugc3RyaWN0JztcblxuXHRsZXQgcG9wdXAgPSBgXG5cdFx0PGRpdiBjbGFzcz1cIm1pc0ZyYW1lXCI+XG5cdFx0XHQ8ZGl2IGNsYXNzPVwiZHJhZ2hhbmRsZVwiPlxuXHRcdFx0XHQ8ZGl2IGNsYXNzPVwibWlzSWNvIG1pc01pblwiPjwvZGl2PlxuXHRcdFx0PC9kaXY+XG5cdFx0PC9kaXY+XG5cdCAgPGlmcmFtZSBjbGFzcz1cIk1pU19Qb3BVcFwiIHNyYz1cIlwiPjwvaWZyYW1lPlxuXHRgXG5cdFxuXHRsZXQgc3ByaXRlID0gYDxkaXYgY2xhc3M9XCJtaXNCdG5GaWxsXCI+PGRpdiBjbGFzcz1cIm1pc0ljbyBtaXNNYXhcIj48L2Rpdj48L2Rpdj5gO1xuXHRsZXQgYnV0dG9ucyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJtYWtlaXRzb2NpYWwtYnV0dG9uXCIpO1xuXHRsZXQgaXNNb2JpbGUgPSBmYWxzZSAvLyBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9BbmRyb2lkfEJsYWNrQmVycnl8aVBob25lfGlQYWR8aVBvZHxPcGVyYSBNaW5pfElFTW9iaWxlL2kpO1xuXHRcblx0Ly8gQ3JlYXRlICYgYXBwZW5kIHRoZSBjb250YWluZXIgZm9yIG9wZW5lZCwgbWluaW1pc2VkIHBvcHVwcy5cblx0bGV0IG1pbmltaXNlZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXHRtaW5pbWlzZWQuY2xhc3NOYW1lID0gXCJtaXNNaW5pbWlzZWRcIjtcblx0ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChtaW5pbWlzZWQpO1xuXHRcblx0Ly8gRHJhZ0NhbnZhcyBpc29sYXRlcyB0aGUgcG9wdXBzIGZyb20gYW55IHVuZGVybHlpbmcgaWZyYW1lcyB0aGF0IGNhbiBjYXB0dXJlIGRyb3AgZXZlbnRzLCBhIGRyYWcgZXZlbnQgcmVtb3ZlcyB0aGUgeyBwb2ludGVyLWV2ZW50czogbm9uZSB9IGNsYXNzIHByb3BlcnR5LiBcblx0bGV0IGRyYWdjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblx0ZHJhZ2NhbnZhcy5jbGFzc05hbWUgPSBcImRyYWdDYW52YXNcIjtcblx0ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChkcmFnY2FudmFzKTtcblx0XG5cdHdpbmRvdy5NSVNidG4gPSB7XG5cdFx0cmVnaXN0ZXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XG5cdFx0XHRsZXQgYnV0dG9ucyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJtYWtlaXRzb2NpYWwtYnV0dG9uXCIpO1xuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBidXR0b25zLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdHZhciBidXR0b24gPSBidXR0b25zW2ldO1xuXHRcdFx0XHRpZiAoYnV0dG9uLmdldEF0dHJpYnV0ZSgnTWlzQnRuUmVnJykpIHsgcmV0dXJuOyB9XG5cdFx0XHRcdGNvbnNvbGUubG9nKCdyZWdpc3RlciBsaXN0ZW5lcicsIGJ1dHRvbik7XG5cdFx0XHRcdGNyZWF0ZUJ1dHRvbihidXR0b25zW2ldKTtcblx0XHRcdFx0YnV0dG9uLnNldEF0dHJpYnV0ZSgnTWlzQnRuUmVnJywgdHJ1ZSlcblx0XHRcdH1cblx0XHR9LFxuXHRcdHVybDogJ2h0dHBzOi8vcG9wdXAubWFrZWl0c29jaWFsLmNvbS8nXG5cdH07XG5cdFxuXHRmdW5jdGlvbiBjcmVhdGVCdXR0b24oYnV0dG9uKSB7XG5cdFx0XG5cdFx0bGV0IGFjdGl2ZSA9IGZhbHNlO1xuXHRcdGxldCBwaWQgPSBidXR0b24uZ2V0QXR0cmlidXRlKCdkYXRhLXBpZCcpO1xuXHRcdGxldCBjb29yZHMgPSBbKHdpbmRvdy5pbm5lcldpZHRoIC8gMikgLSAyMDAsIDIwXTtcblx0XHRsZXQgb2Zmc2V0ID0gWzAsIDBdO1xuXHRcdFxuXHRcdGxldCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblx0XHRcblx0XHRjb250YWluZXIuaW5uZXJIVE1MID0gcG9wdXA7XG5cdFx0Y29udGFpbmVyLnNldEF0dHJpYnV0ZSgnZHJhZ2dhYmxlJywgJ3RydWUnKTtcblx0XHRjb250YWluZXIuc2V0QXR0cmlidXRlKCdvbmRyYWdzdGFydCcsIFwiZXZlbnQuZGF0YVRyYW5zZmVyLnNldERhdGEoJ3RleHQvcGxhaW4nLCAnVGhpcyB0ZXh0IG1heSBiZSBkcmFnZ2VkJylcIik7IC8vIGZpcmVmb3ggZGF0YSB3b3JrYXJvdW5kXG5cdFx0Y29udGFpbmVyLmNsYXNzTmFtZSA9IFwibWlzQ292ZXJcIjtcblx0XHRcblx0XHRsZXQgbG9hZGVyID0gY29udGFpbmVyLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ21pc1NwaW5uZXInKVswXTtcblx0XHRsZXQgaWZyYW1lID0gY29udGFpbmVyLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ01pU19Qb3BVcCcpWzBdO1xuXHRcdGxldCBtaW5pbWkgPSBjb250YWluZXIuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnbWlzTWluJylbMF07XG5cdFx0bGV0IGNhY2hlZFBvcztcblx0XHRsZXQgaXNNaW5pbWlzZWQ7XG5cdFx0XG5cdFx0bGV0IG1heGltaXNlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG5cdFx0bWF4aW1pc2UuY2xhc3NOYW1lID0gXCJtaXNCdG5cIjtcblx0XHRtYXhpbWlzZS5pbm5lckhUTUwgPSBzcHJpdGU7XG5cdFx0bWluaW1pc2VkLmFwcGVuZENoaWxkKG1heGltaXNlKTtcblx0XHRcblx0XHRjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdlbmRcIiwgZnVuY3Rpb24oIGV2ZW50ICkge1xuXHRcdFx0ZHJhZ2NhbnZhcy5jbGFzc05hbWUgPSBcImRyYWdDYW52YXNcIjtcblx0XHRcdHVwZGF0ZVBvcyhjb29yZHMpO1xuICBcdH0sIGZhbHNlKTtcblx0XHRcblx0XHRjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdzdGFydFwiLCBmdW5jdGlvbiggZXZlbnQgKSB7XG5cdFx0XHRkcmFnY2FudmFzLmNsYXNzTmFtZSA9IFwiZHJhZ0NhbnZhcyBhY3RpdmVEcmFnXCI7XG5cdFx0XHRvZmZzZXQgPSBbZXZlbnQub2Zmc2V0WCwgZXZlbnQub2Zmc2V0WV07XG4gIFx0fSwgZmFsc2UpO1xuXHRcdFxuXHQgIGRyYWdjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdvdmVyXCIsIGZ1bmN0aW9uKCBldmVudCApIHtcblx0XHRcdGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRjb29yZHMgPSBbZXZlbnQuY2xpZW50WCAtIG9mZnNldFswXSwgZXZlbnQuY2xpZW50WSAtIG9mZnNldFsxXV07XG5cdCAgfSwgZmFsc2UpO1xuXHRcdFxuXHQgIGRyYWdjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcihcImRyb3BcIiwgZnVuY3Rpb24oIGV2ZW50ICkge1xuXHRcdFx0ZXZlbnQucHJldmVudERlZmF1bHQoKTtcblx0ICB9LCBmYWxzZSk7XG5cdFx0XG5cdFx0ZnVuY3Rpb24gdXBkYXRlUG9zKGMpIHtcblx0XHRcdGNvbnRhaW5lci5zdHlsZS5sZWZ0ID0gY1swXSArICdweCc7XG5cdFx0XHRjb250YWluZXIuc3R5bGUudG9wID0gY1sxXSArICdweCc7XG5cdFx0fVxuXHRcdFxuXHRcdGZ1bmN0aW9uIGxhdW5jaFBvcHVwKGUpIHtcblx0XHRcdFxuXHRcdFx0aWYgKGlzTW9iaWxlKSB7XG5cdFx0XHRcdHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gYCR7IE1JU2J0bi51cmwgfSMvc2V0dXA/cGlkPSR7IHBpZCB9YDsgIFxuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdC8vIE9wZW4gb25seSBvbmUgcG9wdXAgcGVyIGJ1dHRvbjtcblx0XHRcdGlmIChhY3RpdmUpIHtcblx0XHRcdFx0aWYgKGlzTWluaW1pc2VkKSB7IG1heGltaXNlUG9wdXAoKTsgfVxuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHRcblx0XHRcdGRyYWdjYW52YXMuYXBwZW5kQ2hpbGQoY29udGFpbmVyKTtcblx0XHRcdHVwZGF0ZVBvcyhbKHdpbmRvdy5pbm5lcldpZHRoIC8gMikgLSAyMDAsIDIwXSk7XG5cdFx0XHRhY3RpdmUgPSB0cnVlO1xuXHRcdFx0XG5cdFx0XHQvLyBpZnJhbWUub25sb2FkID0gZnVuY3Rpb24oZSkge1xuXHRcdFx0Ly8gXHQvLyBHaXZlIDFzIHRvIGxldCBwYWdlIHJlbmRlciB3aXRoIHByb2R1Y3QgZGV0YWlsc1xuXHRcdFx0Ly8gXHRzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuXHRcdFx0Ly8gXHRcdGxvYWRlci5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cdFx0XHQvLyBcdFx0aWZyYW1lLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG5cdFx0XHQvLyBcdH0sIDEwMDApO1xuXHRcdFx0Ly8gfTtcblx0XHRcdFxuXHRcdFx0ZnVuY3Rpb24gbWluaW1pc2VQb3B1cCgpIHtcblx0XHRcdFx0Y2FjaGVkUG9zID0gW2NvbnRhaW5lci5vZmZzZXRMZWZ0LCBjb250YWluZXIub2Zmc2V0VG9wXTtcblx0XHRcdFx0Y29udGFpbmVyLmNsYXNzTmFtZSA9IFwibWlzQ292ZXIgbWlzTW92ZU1pbiBtaXNBbmltXCI7XG5cdFx0XHRcdG1heGltaXNlLmNsYXNzTmFtZSAgPSBcIm1pc0J0biBtaW1pbWlzZWRcIjtcblx0XHRcdFx0dXBkYXRlUG9zKFtkb2N1bWVudC5ib2R5Lm9mZnNldFdpZHRoIC0gMzAwLCB3aW5kb3cuaW5uZXJIZWlnaHQgLSAxMDBdKTtcblx0XHRcdFx0aXNNaW5pbWlzZWQgPSB0cnVlO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRmdW5jdGlvbiBtYXhpbWlzZVBvcHVwKCkge1xuXHRcdFx0XHRjb250YWluZXIuY2xhc3NOYW1lID0gXCJtaXNDb3ZlciBtaXNBbmltXCI7XG5cdFx0XHRcdG1heGltaXNlLmNsYXNzTmFtZSAgPSBcIm1pc0J0blwiO1xuXHRcdFx0XHR1cGRhdGVQb3MoY2FjaGVkUG9zKTtcblx0XHRcdFx0aXNNaW5pbWlzZWQgPSBmYWxzZTtcblx0XHRcdFx0c2V0VGltZW91dChmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRjb250YWluZXIuY2xhc3NOYW1lID0gXCJtaXNDb3ZlclwiO1xuXHRcdFx0XHR9LCA1MDApO1xuXHRcdFx0fVxuXHRcdFx0XG5cdFx0XHRmdW5jdGlvbiByZWNlaXZlTWVzc2FnZShldmVudCkge1xuXHRcdFx0XHQvLyBUaGlzIGNoZWNrIGlzIGVzc2VudGlhbCB0byBhdm9pZCB4c3MsIHRoaXMgZmVhdHVyZSBwb3B1bGF0ZXMgdGhlIG1heGltaXNlIGJ1dHRvbiB0ZXh0XG5cdFx0XHRcdGlmIChldmVudC5vcmlnaW4gIT09IFwiaHR0cHM6Ly9wb3B1cC1zYW5kYm94Lmhlcm9rdWFwcC5jb21cIiAmJiBldmVudC5vcmlnaW4gIT09IFwiaHR0cHM6Ly9wb3B1cC5tYWtlaXRzb2NpYWwuY29tXCIpIHsgcmV0dXJuOyB9XG5cdFx0XHRcdHZhciBkYXRhID0gSlNPTi5wYXJzZShldmVudC5kYXRhKTtcblx0XHRcdFx0aWYgKGRhdGEucGlkID09PSBwaWQpIHtcblx0XHRcdFx0XHRtYXhpbWlzZS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShkYXRhLm5hbWUpKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0XHRcblx0XHRcdHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLCByZWNlaXZlTWVzc2FnZSwgZmFsc2UpO1xuXHRcdFx0bWF4aW1pc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBtYXhpbWlzZVBvcHVwKTtcblx0XHRcdG1pbmltaS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG1pbmltaXNlUG9wdXApO1xuXHRcdFx0Ly8gdXNlZCBmb3IgbG9jYWwgdGVzdGluZ1xuXHRcdFx0Ly8gaWZyYW1lLnNldEF0dHJpYnV0ZSgnc3JjJywgXCJodHRwOi8vMTI3LjAuMC4xOjgwODAvIy9zZXR1cD9waWQ9XCIgKyBwaWQpOyAgIFxuXHRcdFx0aWZyYW1lLnNldEF0dHJpYnV0ZSgnc3JjJywgYCR7IE1JU2J0bi51cmwgfSMvc2V0dXA/cGlkPSR7IHBpZCB9YCk7XG5cdFx0fVxuXHRcdFxuXHRcdGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGxhdW5jaFBvcHVwKTtcblx0fVxuXHRcbn0pKCkiXX0=
